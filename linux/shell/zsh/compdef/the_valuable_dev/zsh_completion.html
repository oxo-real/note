<!doctype html><html lang=en-us data-theme=dark><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://thevaluable.dev/images/2021/zsh_completion_system/completion.jpg"><meta name=twitter:title content="A Guide to the Zsh Completion with Examples"><meta name=twitter:description content="How work the Zsh completion system and how to configure it according to your needs, without any framework or bloated library."><meta name=twitter:site content="@Cneude_Matthieu"><meta property="og:title" content="A Guide to the Zsh Completion with Examples"><meta property="og:site_name" content="The Valuable Dev"><meta property="og:url" content="https://thevaluable.dev/zsh-completion-guide-examples/"><meta property="og:description" content="How work the Zsh completion system and how to configure it according to your needs, without any framework or bloated library."><meta property="og:type" content="article"><meta property="article:published_time" content="2021-05-27T00:00:00Z"><meta property="article:tag" content="Tools"><meta property="article:tag" content="Mouseless"><title>A Guide to the Zsh Completion with Examples</title><meta name=description content="How work the Zsh completion system and how to configure it according to your needs, without any framework or bloated library."><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://thevaluable.dev/images/favicon.png><link rel=apple-touch-icon href=https://thevaluable.dev/images/apple-touch-icon.png><link rel=stylesheet class=light-theme href=https://thevaluable.dev/css/screen.min.5c85f9d4527987fa7a925afdf2d38a4cc61a3f06927734d8cbcf5aa42c4e0921.css integrity="sha256-XIX51FJ5h/p6klr98tOKTMYaPwaSdzTYy89apCxOCSE="><link rel=stylesheet class=light-theme href=https://thevaluable.dev/css/footer.min.e2cc02bae8873f6086361a606bf2a0b6b52be606c7ad95ae0952b61d2a0daafa.css integrity="sha256-4swCuuiHP2CGNhpga/KgtrUr5gbHrZWuCVK2HSoNqvo=" media=none onload='this.media="screen"'><link href=https://thevaluable.dev/index.xml rel=alternate type=application/rss+xml title="The Valuable Dev"><meta name=generator content="Hugo 0.109.0"><link rel=canonical href=https://thevaluable.dev/zsh-completion-guide-examples/><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","image":"https:\/\/thevaluable.dev\/images\/2021\/zsh_completion_system\/completion.jpg","publisher":{"@type":"Organization","name":"Matthieu Cneude","logo":{"type":"ImageObject","url":"https:\/\/thevaluable.dev\/images\/author.jpg"}},"author":{"@type":"Person","name":"Matthieu Cneude"},"headline":"A Guide to the Zsh Completion with Examples","name":"A Guide to the Zsh Completion with Examples","wordCount":3677,"timeRequired":"PT18M","inLanguage":{"@type":"Language","alternateName":"en"},"url":"https:\/\/thevaluable.dev\/zsh-completion-guide-examples\/","datePublished":"2021-05-27T00:00Z","dateModified":"2021-05-27T00:00Z","keywords":"Tools, Mouseless","description":"How work the Zsh completion system and how to configure it according to your needs, without any framework or bloated library.","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/thevaluable.dev\/zsh-completion-guide-examples\/"}}</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-46898153-4","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script></head><body class=nav-closed><div class=nav><h3 class="nav-title nav-main-title">Menu</h3><a href=# class=nav-close><i class="la la-times-circle"></i></a><ul><li class=nav-opened role=presentation><a href=https://thevaluable.dev/>Home</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/post/>All Articles</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/page/newsletter/>Let's Connect</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/page/books/>Books</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/page/support/>Support</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/page/about>About</a></li><hr class=separation><h3 class="nav-title nav-sub">Categories</h3><li class=nav-opened role=presentation><a href=https://thevaluable.dev/tags/complexity>Complexity</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/tags/fundamentals>Fundamentals</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/tags/mouseless>Mouseless</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/tags/vim>Vim</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/tags/soft-skills>Soft Skills</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/tags/learning>Learning</a></li><li class=nav-opened role=presentation><a href=https://thevaluable.dev/tags/side-project>Side Projects</a></li></ul><a class=subscribe-button href=https://thevaluable.dev/index.xml><i class="la la-feed"></i>&nbsp;&nbsp;RSS</a></div></div><span class=nav-cover></span><div class=site-wrapper><aside class="table-of-content tob-closed"><a href=# class=tob-close><span class=hidden>Close</span></a><nav id=TableOfContents><ul><li><a href=#enabling-the-zsh-completion-system>Enabling the Zsh Completion System</a></li><li><a href=#how-does-the-zsh-completion-system-work>How Does the Zsh Completion System Work</a></li><li><a href=#configuring-zsh-completion-with-zstyle>Configuring Zsh Completion With zstyle</a><ul><li><a href=#whats-zstyle>What&rsquo;s zstyle?</a></li><li><a href=#general-zstyle-patterns-for-completion>General zstyle Patterns for Completion</a></li><li><a href=#examples-of-zstyles-for-the-zsh-completion>Examples of zstyles for the Zsh Completion</a></li></ul></li><li><a href=#useful-style-for-the-zsh-completion-system>Useful Style for the Zsh Completion System</a><ul><li><a href=#the-essential>The Essential</a></li><li><a href=#formatting-the-display>Formatting The Display</a></li><li><a href=#smarter-completion-system>Smarter Completion System</a></li></ul></li><li><a href=#completion-via-keystrokes>Completion via Keystrokes</a></li><li><a href=#the-module-complist>The Module complist</a></li><li><a href=#completion-options>Completion Options</a></li><li><a href=#ready-to-complete>Ready to Complete?</a></li></ul></nav></aside><span class=table-of-content-cover></span><header class="main-header post-head no-cover"><a class=blog-title href=https://thevaluable.dev/>The Valuable Dev</a><ul class=header-menu><li><a href=https://thevaluable.dev/page/newsletter><i class="la la-envelope"></i><span class=text>Let's Connect</span></a></li><li><a href=https://thevaluable.dev/page/books><i class="la la-book"></i><span class=text>Books</span></a></li><li><a href=https://thevaluable.dev/page/support><i class="la la-heart-o"></i><span class=text>Support</span></a></li><li><a href=https://thevaluable.dev/page/about><i class="la la-grin-wink"></i><span class=text>About</span></a></li></ul><nav class="page-nav clearfix"><a class=menu-button href=#>&#9776;&nbsp;&nbsp;Menu</a>
<a id=light-button class="light-button icon-button" href=#><i class="la la-moon-o"></i></a>
<a class="tob-button icon-button" href=#><i class="la la-list"></i></a>
<a class="toggle-search icon-button" title=search><i class="la la-search"></i></a></nav></header><aside role=search><a href=# class="close toggle-search"><i class="la la-times-circle"></i></a><div class=search-wrapper><form class=search method=get><input type=search placeholder=search... disabled></form></div><div class="search-results list"></div></aside><main class=content role=main><article class="post post"><header class=post-header><section class=post-meta><div class=li-date><time class=post-date datetime=2021-05-27T00:00:00Z>27 May 2021</time>
<a class="la la-twitter" style=font-size:1.4em href="https://twitter.com/share?text=A%20Guide%20to%20the%20Zsh%20Completion%20with%20Examples&nbsp;-&nbsp;The%20Valuable%20Dev&url=https%3a%2f%2fthevaluable.dev%2fzsh-completion-guide-examples%2f" onclick='return window.open(this.href,"twitter-share","width=550,height=235"),!1'><span class=hidden>Twitter</span></a></div><span class="post-tag small"><a href=https://thevaluable.dev/tags/tools/>#Tools</a></span>
<span class="post-tag small"><a href=https://thevaluable.dev/tags/mouseless/>#Mouseless</a></span></section><h1 class=post-title>A Guide to the Zsh Completion with Examples</h1></header><section class=post-content><picture><source srcset=https://thevaluable.dev/images/2021/zsh_completion_system/completion.webp type=image/webp><img width=780 height=520 src=https://thevaluable.dev/images/2021/zsh_completion_system/completion.jpg alt="The Zsh Completion System"></picture><p>This article is part of a series about Zsh:</p><div class="notices note"><div class=header><i class="la la-sticky-note-o"></i> Becoming a zsh master</div><div class=body><ol><li><a href=https://thevaluable.dev/zsh-install-configure-mouseless/>Configuring Zsh Without Dependencies</a></li><li><a href=https://thevaluable.dev/zsh-expansion-guide-example/>A Guide to Zsh Expansion with Examples</a></li><li><a href=https://thevaluable.dev/zsh-completion-guide-examples/>A Guide to the Zsh Completion with Examples</a></li><li><a href=https://thevaluable.dev/zsh-line-editor-configuration-mouseless/>A Guide to the Zsh Line Editor with Examples</a></li></ol></div></div><p>&ldquo;The completion offered by Zsh is great, but could it be better? Why not trying to understand how it works? I could then configure it for my own needs!&rdquo;</p><p>This was my thinking a couple of months ago, after waking up a Monday morning full of energy and will to eat my breakfast. I was young and innocent, unaware of the consequences of this thought making its nest in my brain. What could go wrong? After all, it&rsquo;s only a completion system.</p><p>While reading the page of the Zsh manual concerning the completion, I saw the Demon of Complexity™ showing its nose. A dozen of questions were popping up, a twisted configuration syntax was unleashed, nonsensical descriptions were unfolding before my eyes.</p><p>When I see something complex, I can&rsquo;t stop myself trying to simplify it. It took me hours to begin to understand this completion system, but now I think I&rsquo;ve a good grasp on the Beast.</p><p>This article is the result of my efforts. It aims to explain the Zsh completion system in a simple way; more precisely, we&rsquo;ll see:</p><ul><li>How to enable the Zsh completion.</li><li>How does the completion system work.</li><li>What&rsquo;s the purpose of the zstyle module.</li><li>How to use styles to configure the Zsh completion.</li><li>What are the most useful styles we can use to customize the completion.</li><li>How to trigger a precise completion using keystrokes.</li><li>How to customize the completion menu using the module <em>complist</em>.</li><li>What are the Zsh options we can set to configure the completion.</li></ul><p>As I explain in a <a href=https://thevaluable.dev/zsh-install-configure-mouseless/>previous article</a>, I don&rsquo;t use any Zsh framework (like oh-my-zsh or prezto) to have a full control on my config.</p><p>Enough rambling! Let&rsquo;s dive into the fantastic and dangerous Zsh completion system.</p><h2 id=enabling-the-zsh-completion-system>Enabling the Zsh Completion System</h2><p>To initialize the completion for the current session, you need to <em>autoload</em> the function <code>compinit</code> and to call it. To do so, add the following in your file <code>.zshrc</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>autoload -U compinit<span class=p>;</span> compinit
</span></span></code></pre></div><p>If you wonder what&rsquo;s this <code>autoload</code>, I already wrote about it <a href=https://thevaluable.dev/zsh-install-configure-mouseless/>in this article</a>.</p><p>You can also configure your completion with the shell command <code>compinstall</code>. It asks a series of question to decide what kind of completion you need, and it writes automatically your preferences in your <code>.zshrc</code>. In that case, you don&rsquo;t need to autoload and run <code>compinit</code> manually.</p><p>But I find this tool very limited, and the questions it asks are quite obscure. I prefer writing my own config for the completion system in a separate file and source it in my <code>.zshrc</code>. More on that below.</p><p>It&rsquo;s where things become slightly complicated. If you don&rsquo;t care about the details, you can copy and paste <a href=https://github.com/Phantas0s/.dotfiles/blob/master/zsh/completion.zsh target=_blank rel=noopener>my simple config</a> in a file and source it in your <code>.zshrc</code>.</p><h2 id=how-does-the-zsh-completion-system-work>How Does the Zsh Completion System Work</h2><p>Zsh has two completion systems, the old <em>compctl</em> and the more recent <em>compsys</em>. We only look at compsys in this article.</p><p>Concretely, compsys is a collection of Zsh functions. You can find them in the <a href=https://github.com/zsh-users/zsh/tree/master/Completion target=_blank rel=noopener>official repository of Zsh</a>. Three folders are specifically important:</p><ul><li>Base - The core of the completion system, defining the basic completers.</li><li>Zsh - Functions for completing built-in Zsh commands (like <code>cd</code> for example).</li><li>Unix - Function for completing external commands.</li></ul><p>There are also folders for commands only available in some systems, like Solaris, Redhat, or Mandrive for example.</p><p>When you type a command in Zsh and hit the <code>TAB</code> key, a completion is attempted depending on the <em>context</em>. This context includes:</p><ul><li>What command and options have been already typed at the command-line prompt.</li><li>Where the cursor is.</li></ul><p>The context is then given to one or more <em>completer</em> functions which will attempt to complete what you&rsquo;ve typed. Each of these completers are tried in order and, if the first one can&rsquo;t complete the context, the next one will try. When the context can be completed, some possible <em>matches</em> will be displayed and you can choose whatever you want.</p><p>A warning is thrown if none of the completers are able to match the context.</p><p>There are two more things to know about completers:</p><ul><li>The names of completers are prefixed with an underscore, like <code>_complete</code> or <code>_expand_alias</code> for example.</li><li>A few completers return a special value 0 which will stop the completion, even if more completers are defined afterward.</li></ul><h2 id=configuring-zsh-completion-with-zstyle>Configuring Zsh Completion With zstyle</h2><p>You can configure many aspects of the completion system using the zsh module <em>zstyle</em>.</p><p>Modules are part of Zsh but optional, detached from the core of the shell. They can be linked to the shell at build time or dynamically linked while the shell is running.</p><h3 id=whats-zstyle>What&rsquo;s zstyle?</h3><p>You might think that zstyle is used to configure some display styles, but it&rsquo;s much more than that. It&rsquo;s easier to see it as a flexible way to modify the default settings of Zsh scripts (modules, widgets, functions, and so on).
The authors of these scripts need to define what are these settings, what <em>pattern</em> a user can use to modify them, and how these modifications can affect their code.</p><p>Here&rsquo;s the general way you can use zstyle to configure a Zsh module:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle &lt;pattern&gt; &lt;style&gt; &lt;values&gt;
</span></span></code></pre></div><p>The <em>pattern</em> act as a namespace. It&rsquo;s divided by colons <code>:</code> and each value between these colons have a precise meaning.</p><p>In the case of the Zsh completion system, the context we saw earlier (what you&rsquo;ve already typed in your command-line) is compared with this pattern. If there&rsquo;s a match, the style will be applied.</p><p>Don&rsquo;t worry if all of that sounds confusing: bare with me, I&rsquo;ll give some examples soon. For now, let&rsquo;s look a bit closer to the zstyle patterns we can use to configure our completion system.</p><div class="notices note"><div class=header><i class="la la-sticky-note-o"></i> List of styles for the completion system</div><div class=body><ul><li><code>man zshcompsys</code> - Search for &ldquo;Standard Styles&rdquo;</li></ul></div></div><h3 id=general-zstyle-patterns-for-completion>General zstyle Patterns for Completion</h3><p>To configure the completion system, you can use zstyle patterns following this template:</p><pre tabindex=0><code>:completion:&lt;function&gt;:&lt;completer&gt;:&lt;command&gt;:&lt;argument&gt;:&lt;tag&gt;
</code></pre><p>The substring separated with colons <code>:</code> are called <em>components</em>. Let&rsquo;s look at the ones used for the completion system in details:</p><ul><li><code>completion</code> - String acting as a namespace, to avoid pattern collisions with other scripts also using zstyle.</li><li><code>&lt;function></code> - Apply the style to the completion of an external function or widget.</li><li><code>&lt;completer></code> - Apply the style to a specific completer. We need to drop the underscore from the completer&rsquo;s name here.</li><li><code>&lt;command></code> - Apply the style to a specific command, like <code>cd</code>, <code>rm</code>, or <code>sed</code> for example.</li><li><code>&lt;argument></code> - Apply the style to the nth option or the nth argument. It&rsquo;s not available for many styles.</li><li><code>&lt;tag></code> - Apply the style to a specific tag.</li></ul><p>You can think of a tag as a <em>type of match</em>. For example &ldquo;files&rdquo;, &ldquo;domains&rdquo;, &ldquo;users&rdquo;, or &ldquo;options&rdquo; are tags.</p><div class="notices note"><div class=header><i class="la la-sticky-note-o"></i> List of tags</div><div class=body><ul><li><code>man zshcompsys</code> - Search for &ldquo;Standard Tags&rdquo;</li></ul></div></div><p>You don&rsquo;t have to define every component of the pattern. Instead, you can replace each of them with a star <code>*</code>. The more specific the pattern will be, the more precedence it will have over less specific patterns. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:*:cp:*&#39;</span> file-sort size
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> file-sort modification
</span></span></code></pre></div><p>What happens if you set these styles?</p><ol><li>If you hit <code>TAB</code> after typing <code>cp</code>, the possible files matched by the completion system will be ordered by size.</li><li>When you match files using the completion, they will be ordered by date of modification.</li></ol><p>The pattern <code>:completion:*:*:cp:*</code> has precedence over <code>:completion:*</code> because it&rsquo;s considered more precise.</p><p>The <code>*</code> replace any character <em>including the colon</em> <code>:</code>. That&rsquo;s why the pattern <code>:completion:*:*:cp:*</code> is equivalent to <code>:completion:*:cp:*</code>. That said, I find the second form confusing: it&rsquo;s not clear what <code>cp</code> is. Is it a command? A function? A tag? In that case it&rsquo;s pretty obvious, but it&rsquo;s not always <code>cp</code> in the pattern. Personally, I always try to use the first form.</p><p>You can run <code>zstyle</code> in your shell to display the styles set in your current session as well as their patterns.</p><h3 id=examples-of-zstyles-for-the-zsh-completion>Examples of zstyles for the Zsh Completion</h3><p>All of that is quite verbose and not very self-explanatory, so let&rsquo;s look at more examples. Here&rsquo;s a simple one:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> verbose yes
</span></span></code></pre></div><p>This zstyle command is composed of:</p><ul><li>A pattern: <code>:completion:*</code></li><li>A style: <code>verbose</code></li><li>A value: <code>yes</code></li></ul><p>There is only one value given here, because the style <code>verbose</code> only accept one. But you can set more than one for some styles. Each of these values would be separated by a space. For example:</p><pre tabindex=0><code>zstyle &#39;:completion:*:*:cp:*&#39; file-sort modification reverse
</code></pre><p>We give here two values to the style <code>file-sort</code>: <code>modification</code> (to order the matches by date of modification) and <code>reverse</code> (to reverse the order). As we saw before, the pattern <code>:completion:*:*:cp:*</code> indicates that we only set the style <code>file-sort</code> to the command <code>cp</code>.</p><p>Let&rsquo;s see now a couple of styles we can set to improve our Zsh completion.</p><div class="notices note"><div class=header><i class="la la-sticky-note-o"></i> More about zstyle</div><div class=body><ul><li><code>man zshmodules</code> - Search for &ldquo;zstyle&rdquo;</li></ul></div></div><h2 id=useful-style-for-the-zsh-completion-system>Useful Style for the Zsh Completion System</h2><p>I would recommend creating a new file <code>completion.zsh</code> somewhere and sourcing it directly in your file <code>.zshrc</code> as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl><span class=nb>source</span> /path/to/my/completion.zsh
</span></span></code></pre></div><p>Every style defined here should be called after autoloading and calling compinit. If you don&rsquo;t want a separate file, you can throw all this configuration into your <code>.zshrc</code> too.</p><h3 id=the-essential>The Essential</h3><h4 id=defining-the-completers>Defining the Completers</h4><p>Let&rsquo;s first define the completer we&rsquo;ll use for our completion system. Here are some interesting ones:</p><ul><li><code>_complete</code> - This is the main completer we need to use for our completion.</li><li><code>_approximate</code> - This one is similar to <code>_complete</code>, except that it will try to correct what you&rsquo;ve typed already (the context) if no match is found.</li><li><code>_expand_alias</code> - Expand an alias you&rsquo;ve typed. It needs to be declared before <code>_complete</code>.</li><li><code>_extensions</code> - Complete the glob <code>*.</code> with the possible file extensions.</li></ul><p>Note that you can use <code>_expand_alias</code> with the keystroke <code>CTRL+x a</code> by default, without the need to use it as a completer. Simply type one of your alias in Zsh and try to use the keystroke.</p><p>You need to set the zstyle <code>completer</code> to define the completer you want to use. The order matter: the completion system will try each of these completer one after the other. The completion stop when some matches are found or when the completer stop it by itself.</p><p>For example, here are the completers I use:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> completer _extensions _complete _approximate
</span></span></code></pre></div><p>Since we&rsquo;re dabbling into the completion system, the completer <code>_complete_help</code> might come in handy. You can use it as a function you can call with <code>CTRL+x h</code> by default.</p><p>When you&rsquo;re not sure why you end up with some matches and not others, you can hit <code>CTRL+x h</code> (for <code>h</code>elp) before completing your command. It will display some information about what the completion system will do to complete your context.</p><h4 id=caching-the-completion>Caching the Completion</h4><p>Using a cache for the completion can speed up some commands, like <code>apt</code> for example. Let&rsquo;s add the following in our file to enable it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> use-cache on
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> cache-path <span class=s2>&#34;</span><span class=nv>$XDG_CACHE_HOME</span><span class=s2>/zsh/.zcompcache&#34;</span>
</span></span></code></pre></div><p>As you might have guessed, the style <code>cache-path</code> allows you to set the filename and location of the cache.</p><h4 id=the-completion-menu>The Completion Menu</h4><p>Instead of going through each match blindly to add what you want to your command, you can use a <em>completion menu</em>. For that, you need to set the style <code>menu</code> with the value <code>select</code> as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> menu <span class=k>select</span>
</span></span></code></pre></div><p>You can also use this menu only if a precise <code>&lt;number></code> of matches is found with <code>select=&lt;number></code>. It&rsquo;s even possible to start the menu selection only if the list of matches doesn&rsquo;t fit the screen, by using the value <code>select=long</code>. Using both values <code>select=&lt;number></code> and <code>select=long</code> is possible too.</p><p>Having the values <code>select</code> and <code>interactive</code> allows you to filter the completion menu itself using the completion system. You can also configure a keystroke to switch this <em>interactive mode</em> when the completion menu is displayed. More on that later in this article.</p><p>Adding the value <code>search</code> to the style will allow you to fuzzy-search the completion menu. Again, a keystroke can be configured to have this functionality on demand.</p><h3 id=formatting-the-display>Formatting The Display</h3><h4 id=colors-and-decoration>Colors and Decoration</h4><p>Let&rsquo;s now improve the display of our completion menu using the style <code>format</code>.</p><p>Each completer can define different <em>sequences</em> (beginning with <code>%</code>) for different tags. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:*:*:*:descriptions&#39;</span> format <span class=s1>&#39;%F{green}-- %d --%f&#39;</span>
</span></span></code></pre></div><p>As we saw quickly above, a tag is <em>most of the time</em> a type of match. More generally, you can see it as a type of information displayed during completion. Here, the <code>descriptions</code> tag is specific to the <code>format</code> style. It generates descriptions depending on the type of match. For example, if you have files displayed in the completion menu, the description for the tag &ldquo;files&rdquo; will be displayed too.</p><p>The value of <code>format</code> is used for displaying these descriptions. Here, we use in the style&rsquo;s value the sequence <code>%d</code> which will be replaced by the description itself.</p><p>Here&rsquo;s the result for local directories:</p><picture><source srcset=https://thevaluable.dev/images/2021/zsh_completion_system/format_description.webp type=image/webp><img width=780 height=520 src=https://thevaluable.dev/images/2021/zsh_completion_system/format_description.png alt="Zsh format style with description for completion system"></picture><p>If you&rsquo;re using the completer <code>_approximate</code>, you can set the format of the possible corrections too. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:*:*:*:corrections&#39;</span> format <span class=s1>&#39;%F{yellow}!- %d (errors: %e) -!%f&#39;</span>
</span></span></code></pre></div><p>Here&rsquo;s the result:</p><picture><source srcset=https://thevaluable.dev/images/2021/zsh_completion_system/format_correction.webp type=image/webp><img width=780 height=520 src=https://thevaluable.dev/images/2021/zsh_completion_system/format_correction.png alt="Zsh format style with correction for completion system"></picture><p>To format messages or warnings (for example when no match is found), you can add the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:messages&#39;</span> format <span class=s1>&#39; %F{purple} -- %d --%f&#39;</span>
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:warnings&#39;</span> format <span class=s1>&#39; %F{red}-- no matches found --%f&#39;</span>
</span></span></code></pre></div><p>We can use the escape sequence <code>%F %f</code> in the style&rsquo;s value to use a foreground color. Here&rsquo;s a summary of sequences you can use:</p><ul><li><code>%F{&lt;color>} %f</code> - Change the foreground color with <code>&lt;color></code>.</li><li><code>%K{&lt;color>} %k</code> - Change the background color with <code>&lt;color></code>.</li><li><code>%B %b</code> - Bold.</li><li><code>%U %u</code> - Underline.</li></ul><p>For example, you can create a horrible display as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:descriptions&#39;</span> format <span class=s1>&#39;%U%K{yellow} %F{green}-- %F{red} %BNICE!1! %b%f %d --%f%k%u&#39;</span>
</span></span></code></pre></div><p>Your descriptions are now a piece of art.</p><h4 id=grouping-results>Grouping Results</h4><p>To group the different type of matches under their descriptions, you can add the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> group-name <span class=s1>&#39;&#39;</span>
</span></span></code></pre></div><p>Without this style, all the descriptions will be at the top and the matches at the bottom:</p><picture><source srcset=https://thevaluable.dev/images/2021/zsh_completion_system/before_group.webp type=image/webp><img width=780 height=520 src=https://thevaluable.dev/images/2021/zsh_completion_system/before_group.jpg alt="Before setting the style group-name in Zsh"></picture><p>With the value of this style set with an empty string, the matches will be grouped under the descriptions depending on their types:</p><picture><source srcset=https://thevaluable.dev/images/2021/zsh_completion_system/after_group.webp type=image/webp><img width=780 height=520 src=https://thevaluable.dev/images/2021/zsh_completion_system/after_group.jpg alt="after setting the style group-name in Zsh"></picture><p>If you&rsquo;re not satisfied by the order these descriptions are displayed, you can modify it too. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:*:-command-:*:*&#39;</span> group-order <span class=nb>alias</span> builtins functions commands
</span></span></code></pre></div><p>Here, <code>-command-</code> means any word in the &ldquo;command position&rdquo;. It means that we want the matches tagged <code>alias</code> to appear before <code>builtins</code>, <code>functions</code>, and <code>commands</code>.</p><h4 id=detailed-list-of-files-and-folders>Detailed List of Files and Folders</h4><p>The style <code>file-list</code> can display the list of files and folder matched with more details, similar to the information you can display with <code>ls -l</code>.</p><p>For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> file-list all
</span></span></code></pre></div><p>Here&rsquo;s the result:</p><picture><source srcset=https://thevaluable.dev/images/2021/zsh_completion_system/long_list_file.webp type=image/webp><img width=780 height=520 src=https://thevaluable.dev/images/2021/zsh_completion_system/long_list_file.jpg alt="Before setting the style group-name in Zsh"></picture><h4 id=colorful-completion-list>Colorful Completion List</h4><p>To have nice colors for your directories and file in the completion menu, you can add the style <code>list-colors</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*:default&#39;</span> list-colors <span class=si>${</span><span class=p>(s.:.)LS_COLORS</span><span class=si>}</span>
</span></span></code></pre></div><p>It will set the value with the content of the environment variable <code>LS_COLORS</code>, normally used by the command <code>ls --color=auto</code>.</p><p>You apparently need to have the module <code>zsh/complist</code> loaded, but it worked without it on my system. I describe a bit more the module complist later in this article.</p><p>You can configure the colors of any completion menu even further using the environment variable <code>ZLS_COLORS</code>.</p><div class="notices note"><div class=header><i class="la la-sticky-note-o"></i> Configuring the colors</div><div class=body><ul><li><code>man zshmodules</code> - Search &ldquo;Colored completion listings&rdquo;</li></ul></div></div><h3 id=smarter-completion-system>Smarter Completion System</h3><h4 id=squeezing-slashes>Squeezing Slashes</h4><p>By default, the completion system will expand <code>//</code> to <code>/*/</code>. For example, <code>cd ~//Documents</code> will be expanded to <code>cd ~/*/Documents</code>.</p><p>Usually, on Unix systems, <code>//</code> is expanded to <code>/</code>. If you prefer this behavior, you can set the style <code>squeeze-slashes</code> to true as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> squeeze-slashes <span class=nb>true</span>
</span></span></code></pre></div><h4 id=directory-stack-completion>Directory Stack Completion</h4><p>For the command <code>cd</code>, <code>chdir</code> and <code>pushd</code>, you can use a hyphen <code>-</code> not only for options but for a directory stack entry.</p><p>By default, the Zsh completion system will try to complete for a directory stack entry when you hit tab after a hyphen <code>-</code> while using one of these commands. If you prefer completing for an option, you can set the style <code>complete-options</code> to true as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> complete-options <span class=nb>true</span>
</span></span></code></pre></div><p>If you&rsquo;re interested to learn more about the directory stack, I described a nice way to navigate through it <a href=https://thevaluable.dev/zsh-install-configure-mouseless/>in this article</a></p><h4 id=sorting-matched-files>Sorting Matched Files</h4><p>You can sort the files appearing in the completion menu as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> file-sort dummyvalue
</span></span></code></pre></div><p>If this style is not set (or set with a dummy value like in the example above), the files will be sorted alphabetically. You can use one of these values if you prefer another ordering:</p><ul><li><code>size</code> - Order files by size.</li><li><code>links</code> - Order files depending on the links pointing to them.</li><li><code>modification</code> or <code>date</code> or <code>time</code> - Order files by date of modification.</li><li><code>access</code> - Order files by time of access.</li><li><code>change</code> or <code>inode</code> - Order files by the time of change.</li></ul><p>You can also add <code>reverse</code> to the values to reverse the order. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> file-sort change reverse
</span></span></code></pre></div><p>If you add the value <code>follow</code>, the timestamp of the targets for symlinks will be used instead of the timestamp of the symlinks themselves.</p><h4 id=completion-matching-control>Completion Matching Control</h4><p>Setting the style <code>matcher-list</code> allows you to filter the matches of the completion with even more patterns.</p><p>For example, you can set this style for the completion to first try the usual completion and, if nothing matches, to try a case-insensitive completion:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> matcher-list <span class=s1>&#39;&#39;</span> <span class=s1>&#39;m:{a-zA-Z}={A-Za-z}&#39;</span>
</span></span></code></pre></div><p>The completion can also try to complete partial words you&rsquo;ve typed with the following style:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:*&#39;</span> matcher-list <span class=s1>&#39;&#39;</span> <span class=s1>&#39;m:{a-zA-Z}={A-Za-z}&#39;</span> <span class=s1>&#39;r:|[._-]=* r:|=*&#39;</span> <span class=s1>&#39;l:|=* r:|=*&#39;</span>
</span></span></code></pre></div><p>This style would allow you, for example, to complete the file <code>_DSC1704.JPG</code> if you only try to complete its substring <code>1704</code>.</p><p>The patterns themselves are quite&mldr; obscure. If you want a good intellectual challenge, you can look at the manual. I wish you good luck.</p><div class="notices note"><div class=header><i class="la la-sticky-note-o"></i> Patterns for the style matcher list</div><div class=body><ul><li><code>man zshcompwid</code> - Search for &ldquo;COMPLETION MATCHING CONTROL&rdquo;</li></ul></div></div><h2 id=completion-via-keystrokes>Completion via Keystrokes</h2><p>You can bind any completion style to a keystroke instead of using it with the general completion. For that, you need to use the completer <code>_generic</code>.</p><p>For example, if you want to expand aliases each time you hit <code>CTRL+a</code>, you can add the following lines:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zle -C alias-expension complete-word _generic
</span></span><span class=line><span class=cl>bindkey <span class=s1>&#39;^a&#39;</span> alias-expension
</span></span><span class=line><span class=cl>zstyle <span class=s1>&#39;:completion:alias-expension:*&#39;</span> completer _expand_alias
</span></span></code></pre></div><p>You can replace <code>alias-expension</code> by the name of your choice. The behavior depends of the completer you use; for expanding aliases, we use <code>_expand_alias</code>. Feel free to use whatever completer you want for your own needs.</p><h2 id=the-module-complist>The Module complist</h2><p>I wrote already about the module &ldquo;complist&rdquo; <a href=https://thevaluable.dev/zsh-install-configure-mouseless/>in this article</a>. We saw there how to move around in the completion menu using the keys &ldquo;hjkl&rdquo;:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>zmodload zsh/complist
</span></span><span class=line><span class=cl>bindkey -M menuselect <span class=s1>&#39;h&#39;</span> vi-backward-char
</span></span><span class=line><span class=cl>bindkey -M menuselect <span class=s1>&#39;k&#39;</span> vi-up-line-or-history
</span></span><span class=line><span class=cl>bindkey -M menuselect <span class=s1>&#39;j&#39;</span> vi-down-line-or-history
</span></span><span class=line><span class=cl>bindkey -M menuselect <span class=s1>&#39;l&#39;</span> vi-forward-char
</span></span></code></pre></div><p>You can configure many more keystrokes related to the completion menu using these commands:</p><ul><li><code>accept-line</code> - Validate the selection and leave the menu.</li><li><code>send-break</code> - Leaves the menu selection and restore the previous command.</li><li><code>clear-screen</code> - Clear the screen without leaving the menu selection.</li><li><code>accept-and-hold</code> - Insert the match in your command and let the completion menu open to insert another match.</li><li><code>accept-and-infer-next-history</code> - Insert the match and, in case of directories, open completion menu to complete its children.</li><li><code>undo</code> - Undo.</li><li><code>vi-forward-blank-word</code> - Move cursor to next group of match.</li><li><code>vi-backward-blank-word</code> - Move cursor to previous group of match.</li><li><code>beginning-of-buffer-or-history</code> - Move the cursor to the leftmost column.</li><li><code>end-of-buffer-or-history</code> - Move the cursor to the rightmost column.</li><li><code>vi-insert</code> - Toggle between normal and interactive mode. We&rsquo;ve seen the interactive mode above.</li><li><code>history-incremental-search-forward</code> and <code>history-incremental-search-backward</code> - Begin incremental search.</li></ul><p>For example, I&rsquo;ve configured <code>CTRL+x i</code> to switch to the interactive mode in the completion menu:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>bindkey -M menuselect <span class=s1>&#39;^xi&#39;</span> vi-insert
</span></span></code></pre></div><div class="notices note"><div class=header><i class="la la-sticky-note-o"></i> Configuring complist</div><div class=body><ul><li><code>man zshmodules</code> - Search for &ldquo;THE ZSH/COMPLIST MODULE&rdquo;</li></ul></div></div><h2 id=completion-options>Completion Options</h2><p>You can also use options to modify the Zsh completion system. To set an option, you need to use the command <code>setopt</code>. For example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>setopt MENU_COMPLETE
</span></span></code></pre></div><p>Here&rsquo;s a small selection of useful options for configuring the completion system:</p><ul><li><code>ALWAYS_TO_END</code> - Always place the cursor to the end of the word completed.</li><li><code>LIST_PACKED</code> - The completion menu takes less space.</li><li><code>AUTO_MENU</code> - Display the completion menu after two use of the <code>TAB</code> key.</li><li><code>AUTO_COMPLETE</code> - Select the first match given by the completion menu. Override <code>AUTO_MENU</code>.</li><li><code>AUTO_PARAM_SLASH</code> - When a directory is completed, add a trailing slash instead of a space.</li><li><code>COMPLETE_IN_WORD</code> - By default, the cursor goes at the end of the word when completion start. Setting this will not move the cursor and the completion will happen on both end of the word completed.</li><li><code>GLOB_COMPLETE</code> - Trigger the completion after a glob <code>*</code> instead of expanding it.</li><li><code>LIST_ROWS_FIRST</code> - Matches are sorted in rows instead of columns.</li></ul><div class="notices note"><div class=header><i class="la la-sticky-note-o"></i> Completion options</div><div class=body><ul><li><code>man zshoptions</code> - Search for &ldquo;Completion&rdquo;</li></ul></div></div><h2 id=ready-to-complete>Ready to Complete?</h2><p>The Zsh completion system is a complex beast, but I tried to do my best to simplify it. I hope it didn&rsquo;t cause any headache on your side.</p><p>What did we learn together in this article?</p><ul><li>The completion system go through a series of <em>completers</em> first. They&rsquo;ll try to find matches depending on the context (the command you&rsquo;ve typed) using different completion functions.</li><li>The Zsh module &ldquo;zstyle&rdquo; allows you to configure settings for a specific Zsh module or widget. Don&rsquo;t let the name <code>style</code> fools you: it can configure way more than visual styles.</li><li>You can configure the Zsh completion system using options and the module complist, but using zstyle is the most flexible way to tune it following your craziest wishes.</li></ul><p>As you see, the completion system of Zsh is far from being simple. I&rsquo;ve covered some of the basics here, but there&rsquo;s much more. Let me know if you want a follow-up article to dive even deeper in this madness.</p><div class=related-sources><div class=h2>Related Sources</div><ul><li><a href=http://zsh.sourceforge.net/Doc/Release/Completion-System.html target=_blank rel=noopener>Zsh Documentation - The Completion System</a></li><li><a href=http://zsh.sourceforge.net/Doc/Release/Prompt-Expansion.html#Visual-effects target=_blank rel=noopener>Zsh Documentation - Visual Effects</a></li><li><a href=https://github.com/Phantas0s/.dotfiles/blob/master/zsh/completion.zsh target=_blank rel=noopener>Author&rsquo;s configuration for the Zsh completion system</a></li><li><a href=https://github.com/sorin-ionescu/prezto/blob/master/modules/completion/init.zsh target=_blank rel=noopener>Completions from the prezto framework</a> - Robby Russell, Sorin Ionescu, and contributors</li></ul></div></section><footer class=post-footer><section class=newsletter><form action=https://buttondown.email/api/emails/embed-subscribe/thevaluabledev method=post target=popupwindow onsubmit='window.open("https://buttondown.email/thevaluabledev","popupwindow")' class=embeddable-buttondown-form><h3>Let's Connect</h3><p><label for=bd-email>You'll receive <b>each month</b> the last article with additional resources and updates.</label></p><input type=email name=email placeholder=your-email@example.com id=bd-email>
<input type=hidden value=1 name=embed></input>
<input type=submit value="I want more!"></input><p><a target=_blank title="Show me your newsletter!" href=https://buttondown.email/thevaluabledev/archive/the-valuable-dev-new-article-about-vim-and-many/>Here's how it looks</a></p><p>You can reply to any email if you have questions, problems, or feedback. I'll write back as soon as I can.</p></form></form></section><div class="h3 remark42">Share Your Knowledge</div><div id=remark42></div><script>for(var remark_config={host:"https://remark42.thevaluable.dev",site_id:"jadzD9w1sijz",components:["embed"],max_shown_comments:10},buttons=document.getElementsByClassName("light-button"),i=0;i<buttons.length;i++)buttons[i].addEventListener("click",()=>{let e=window.localStorage.getItem("theme");(e==null||e=="light")&&window.REMARK42!=void 0&&window.REMARK42.changeTheme("dark"),e=="dark"&&window.REMARK42!=void 0&&window.REMARK42.changeTheme("light")});(function(e){for(t=0;t<e.length;t++){var t,n=document,s=n.createElement("script");s.src=remark_config.host+"/web/"+e[t]+".js",s.defer=!0,window.addEventListener("scroll",function(){var e=window.localStorage.getItem("theme");e==null||e=="light"?remark_config.theme="light":remark_config.theme="dark",(n.head||n.body).appendChild(s)},{once:!0})}})(remark_config.components||["embed"])</script></footer></article></main><aside class=read-next id=read-next><a class=read-next-story style=background-image:url(/images/2018/env/build_workshop.webp) href=https://thevaluable.dev/mouseless-development-environment/><section class=post><h2>A Mouseless Development Environment</h2></section></a><a class="read-next-story prev" style=background-image:url(/images/2022/regex_advanced/very_magic_nomagic.webp) href=https://thevaluable.dev/vim-regular-expressions-in-depth/><section class=post><h2>Diving Deeper in Vim Regular Expressions</h2></section></a></aside><footer class=site-footer><section class=copyright><a href>The Valuable Dev</a> All right reserved - 2021</section><section class=social><a class=bloglogo href=https://thevaluable.dev/page/newsletter target=_blank><span class="la la-envelope"></span></a>
&nbsp;
<a class=bloglogo href=https://github.com/phantas0s target=_blank><span class="la la-github"></span></a>
&nbsp;
<a class=bloglogo href=https://youtube.com/channel/UCoJtk2M8bme9KXTe6F3K-Yg target=_blank><span class="la la-youtube"></span></a>
&nbsp;
<a class=bloglogo href=https://twitter.com/Cneude_Matthieu target=_blank><span class="la la-twitter"></span></a>
&nbsp;
<a class=bloglogo href=https://www.linkedin.com/in/matthieu-cneude-28038182 target=_blank><span class="la la-linkedin"></span></a>
&nbsp;
<a class=bloglogo href=https://thevaluable.dev/index.xml target=blank><span class="la la-feed"></span></a></section><section class=poweredby>Proudly generated by <a class=icon-hugo href=http://gohugo.io>HUGO</a></section></footer></div><link rel=stylesheet href=https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css media=none onload='this.media="screen"'><script type=text/javascript src=https://thevaluable.dev/app.881bf33056625cefe0a3d47b272cef91c09a8403aed71fcc0bb589a2e3b23d3a.js integrity="sha256-iBvzMFZiXO/go9R7JyzvkcCahAOu1x/MC7WJouOyPTo=" media=screen></script></body></html>